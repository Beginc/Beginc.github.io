{"title":"Vagrant自动虚拟机部署","date":"2020-02-08T09:25:26.000Z","date_formatted":{"ll":"Feb 8, 2020","L":"02/08/2020","MM-DD":"02-08"},"thumbnail":"post/自动化运维/Vagrant自动虚拟机部署/cover.png","link":"post/自动化运维/Vagrant自动虚拟机部署","categories":["自动化运维"],"updated":"2020-02-08T09:32:09.938Z","content":"<h1 id=\"vagrantfile\">Vagrantfile<a href=\"#vagrantfile\" title=\"Vagrantfile\"></a></h1><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- mode: ruby -*-</span></span><br><span class=\"line\"><span class=\"comment\"># vi: set ft=ruby :</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 三台虚拟机</span></span><br><span class=\"line\">boxes = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"comment\"># 主机名</span></span><br><span class=\"line\">    <span class=\"symbol\">:hostname</span> =&gt; <span class=\"string\">\"master\"</span>,</span><br><span class=\"line\">    <span class=\"comment\"># IP地址</span></span><br><span class=\"line\">    <span class=\"symbol\">:ip</span> =&gt; <span class=\"string\">\"192.168.31.201\"</span>,</span><br><span class=\"line\">    <span class=\"comment\"># 分配的内存</span></span><br><span class=\"line\">    <span class=\"symbol\">:mem</span> =&gt; <span class=\"string\">\"2048\"</span>,</span><br><span class=\"line\">    <span class=\"comment\"># CPU核心</span></span><br><span class=\"line\">    <span class=\"symbol\">:cpu</span> =&gt; <span class=\"string\">\"1\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"symbol\">:hostname</span> =&gt; <span class=\"string\">\"node1\"</span>,</span><br><span class=\"line\">    <span class=\"symbol\">:ip</span> =&gt; <span class=\"string\">\"192.168.31.103\"</span>,</span><br><span class=\"line\">    <span class=\"symbol\">:mem</span> =&gt; <span class=\"string\">\"2048\"</span>,</span><br><span class=\"line\">    <span class=\"symbol\">:cpu</span> =&gt; <span class=\"string\">\"1\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"symbol\">:hostname</span> =&gt; <span class=\"string\">\"node2\"</span>,</span><br><span class=\"line\">    <span class=\"symbol\">:ip</span> =&gt; <span class=\"string\">\"192.168.31.104\"</span>,</span><br><span class=\"line\">    <span class=\"symbol\">:mem</span> =&gt; <span class=\"string\">\"2048\"</span>,</span><br><span class=\"line\">    <span class=\"symbol\">:cpu</span> =&gt; <span class=\"string\">\"1\"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Vagrant.configure(<span class=\"string\">\"2\"</span>) <span class=\"keyword\">do</span> <span class=\"params\">|config|</span></span><br><span class=\"line\">  <span class=\"comment\"># 使用centos/7 Box</span></span><br><span class=\"line\">  config.vm.box = <span class=\"string\">\"centos/7\"</span></span><br><span class=\"line\">  <span class=\"comment\"># Box版本</span></span><br><span class=\"line\">  config.vm.box_version = <span class=\"string\">\"1905.1\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">  boxes.each <span class=\"keyword\">do</span> <span class=\"params\">|opts|</span></span><br><span class=\"line\">    config.vm.define opts[<span class=\"symbol\">:hostname</span>] <span class=\"keyword\">do</span> <span class=\"params\">|config|</span></span><br><span class=\"line\">      config.vm.hostname = opts[<span class=\"symbol\">:hostname</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">      config.vm.provider <span class=\"string\">\"virtualbox\"</span> <span class=\"keyword\">do</span> <span class=\"params\">|v|</span></span><br><span class=\"line\">        v.customize [<span class=\"string\">\"modifyvm\"</span>, <span class=\"symbol\">:id</span>, <span class=\"string\">\"--memory\"</span>, opts[<span class=\"symbol\">:mem</span>]]</span><br><span class=\"line\">        v.customize [<span class=\"string\">\"modifyvm\"</span>, <span class=\"symbol\">:id</span>, <span class=\"string\">\"--cpus\"</span>, opts[<span class=\"symbol\">:cpu</span>]]</span><br><span class=\"line\">      <span class=\"keyword\">end</span></span><br><span class=\"line\">      <span class=\"comment\"># 设置共有网络，静态IP</span></span><br><span class=\"line\">      config.vm.network <span class=\"string\">\"public_network\"</span>, <span class=\"symbol\">ip:</span> opts[<span class=\"symbol\">:ip</span>]</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"comment\"># 安装wget工具</span></span><br><span class=\"line\">  config.vm.provision <span class=\"string\">\"shell\"</span>, <span class=\"symbol\">privileged:</span> <span class=\"literal\">true</span>, <span class=\"symbol\">inline:</span> <span class=\"string\">\"yum install wget -y\"</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"虚拟机管理\">虚拟机管理<a href=\"#虚拟机管理\" title=\"虚拟机管理\"></a></h1><div class=\"cz\"><div class=\"db\"><table><thead><tr>\n<th align=\"center\">命令</th><th align=\"center\">作用</th></tr>\n</thead><tbody><tr>\n<td align=\"center\">vagrant up</td><td align=\"center\">部署启动虚拟机</td></tr>\n<tr>\n<td align=\"center\">vagrant suspend</td><td align=\"center\">挂起虚拟机</td></tr>\n<tr>\n<td align=\"center\">vagrant halt</td><td align=\"center\">关机</td></tr>\n<tr>\n<td align=\"center\">vagrant destroy</td><td align=\"center\">撤销虚拟机一切资源</td></tr>\n</tbody></table></div></div><h1 id=\"存在的问题-todo\">存在的问题 TODO<a href=\"#存在的问题-todo\" title=\"存在的问题 TODO\"></a></h1><p>目前只能用<code>vagrant ssh</code>进行登录，不能通过正常的<code>SSH</code>进行登录，这样就无法使用<code>Ansible</code>进行自动化运维。</p>\n","prev":{"title":"CentOS7下MySQL5.7安装","link":"post/数据库/MySQL/CentOS7下MySQL5-7安装"},"next":{"title":"7-Ansible执行速度优化","link":"post/自动化运维/Ansible/8-Ansible执行速度优化"},"plink":"https://beginc.github.io/post/自动化运维/Vagrant自动虚拟机部署/","toc":[{"id":"vagrantfile","title":"Vagrantfile","index":"1"},{"id":"虚拟机管理","title":"虚拟机管理","index":"2"},{"id":"存在的问题-todo","title":"存在的问题 TODO","index":"3"}]}