{"title":"7-Ansible执行速度优化","date":"2020-02-07T13:24:27.000Z","date_formatted":{"ll":"Feb 7, 2020","L":"02/07/2020","MM-DD":"02-07"},"thumbnail":"post/自动化运维/Ansible/8-Ansible执行速度优化/cover.png","link":"post/自动化运维/Ansible/8-Ansible执行速度优化","categories":["Ansible","自动化运维"],"updated":"2020-02-08T02:54:03.698Z","content":"<h1 id=\"优化一：开启ssh长连接\">优化一：开启SSH长连接<a href=\"#优化一：开启ssh长连接\" title=\"优化一：开启SSH长连接\"></a></h1><p><code>Ansible</code>使用<code>SSH</code>和远程主机进行通信, 所以<code>Ansible</code>对<code>SSH</code>的依赖性非常强, 在<code>OpenSSH 5.6</code>版本以后<code>SSH</code>就支持了<code>Multiplexing</code>。所以如果<code>Ansible</code>中被控端的<code>SSH</code> 版本高于5.6时, 我们可以直接在<code>ansible.cfg</code>文件中设置<code>SSH</code>长连接。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[ssh_connection]</span></span><br><span class=\"line\"><span class=\"comment\"># ControlPersist=5d意思为SSH长连接持续5天</span></span><br><span class=\"line\"><span class=\"attr\">ssh_args</span> = -C -o ControlMaster=auto -o ControlPersist=<span class=\"number\">5</span>d</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"优化二：开启pipelining\">优化二：开启Pipelining<a href=\"#优化二：开启pipelining\" title=\"优化二：开启Pipelining\"></a></h1><p><code>Pipelining</code>也是<code>OpenSSH</code>的一个特性, 在<code>Ansible</code>的整个执行流程中, 把生成好的本地<code>Python</code>脚本<code>PUT</code>到远程服务器. 如果开启了<code>Pipelining</code>, 这个过程将在<code>SSH</code>会话中进行, 这样可以大大提高整个执行效率.当然开启<code>Pipelining</code>, 需要被控机<code>/etc/sudoers</code>文件编辑当前<code>Ansible</code>的<code>SSH</code>用户的配置为<code>requiretty</code>. 否则在执行<code>Ansible</code>的时候会提示报错.</p>\n<h1 id=\"优化三：开启accelerate模式\">优化三：开启accelerate模式<a href=\"#优化三：开启accelerate模式\" title=\"优化三：开启accelerate模式\"></a></h1><p>已经废弃了。</p>\n","next":{"title":"6-Ansible常用Playbook关键字","link":"post/自动化运维/Ansible/7-Ansible常用Playbook关键字"},"plink":"https://beginc.github.io/post/自动化运维/Ansible/8-Ansible执行速度优化/","toc":[{"id":"优化一：开启ssh长连接","title":"优化一：开启SSH长连接","index":"1"},{"id":"优化二：开启pipelining","title":"优化二：开启Pipelining","index":"2"},{"id":"优化三：开启accelerate模式","title":"优化三：开启accelerate模式","index":"3"}]}