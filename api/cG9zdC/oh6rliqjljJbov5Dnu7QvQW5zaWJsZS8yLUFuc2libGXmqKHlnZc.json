{"title":"2-Ansible模块","date":"2020-02-06T08:39:32.000Z","date_formatted":{"ll":"Feb 6, 2020","L":"02/06/2020","MM-DD":"02-06"},"thumbnail":"post/自动化运维/Ansible/2-Ansible模块/cover.png","link":"post/自动化运维/Ansible/2-Ansible模块","categories":["Ansible","自动化运维"],"updated":"2020-02-08T02:53:46.404Z","content":"<h1 id=\"模块概述\">模块概述<a href=\"#模块概述\" title=\"模块概述\"></a></h1><p><code>Ansible</code>内置了许多模块，每一个模块都对应着在被控端的一些操作。</p>\n<h1 id=\"ansible\">Ansible<a href=\"#ansible\" title=\"Ansible\"></a></h1><p>可使用<code>ansible</code>来调用模块。</p>\n<h2 id=\"调用格式\">调用格式<a href=\"#调用格式\" title=\"调用格式\"></a></h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible 主机模式 -m 模块名 -a 参数 ansible参数</span><br></pre></td></tr></table></figure>\n\n<p><strong>ansible参数</strong></p>\n<ul><li><code>--version</code>显示版本</li>\n</ul><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible --version</span><br></pre></td></tr></table></figure>\n\n<ul><li><p><code>-k</code>提示输入<code>SSH</code>连接密码</p>\n</li>\n<li><p><code>-K</code>提示输入<code>sudo</code>的密码</p>\n</li>\n<li><p><code>-C</code>进行检查，并不真实执行模块</p>\n</li>\n<li><p><code>-T</code>执行命令的超时时间</p>\n</li>\n<li><p><code>-u</code>远程执行的用户</p>\n</li>\n</ul><p><strong>主机模式</strong></p>\n<ul><li><code>192.168.31.101</code>单独一个主机</li>\n<li><code>组名</code>组内所有主机</li>\n<li><code>all</code>所有主机</li>\n<li><code>192.168.31.10*</code>通配符</li>\n<li><code>group1:group2</code>组1或组2内的主机都匹配</li>\n<li><code>group1:&amp;group2</code>同时在组1和组2的主机匹配</li>\n<li><code>group1:!group2</code>在组1但不在组2的主机匹配</li>\n<li><code>192.168.10[1:2]</code>正则表达式</li>\n</ul><h1 id=\"常用模块\">常用模块<a href=\"#常用模块\" title=\"常用模块\"></a></h1><h2 id=\"command\">command<a href=\"#command\" title=\"command\"></a></h2><p>默认模块，若不加<code>-m 模块名</code>，则默认执行该模块。</p>\n<p>该模块用于执行一些<code>Shell</code>命令，但该模块不能执行一些带有特殊符号的命令，如<code>|</code>, <code>&lt;</code>, <code>&gt;</code>, <code>;</code>, <code>&amp;</code>等。</p>\n<p><strong>参数</strong></p>\n<ul><li><code>chdir</code>执行命令前先进入某个目录</li>\n<li><code>creates</code>判断文件是否存在，若存在则不执行</li>\n<li><code>removes</code>判断文件是否存在，若存在则执行</li>\n</ul><p><strong>示例</strong></p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible mq -m <span class=\"built_in\">command</span> -a <span class=\"string\">'removes=/etc/hosts chdir=/etc/ cat ./hosts'</span></span><br></pre></td></tr></table></figure>\n\n<img src=\"/post/%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/Ansible/2-Ansible%E6%A8%A1%E5%9D%97/1.png\" class=\"\">\n\n<h2 id=\"shell\">Shell<a href=\"#shell\" title=\"Shell\"></a></h2><p><code>command</code>模块的升级版，支持特殊符号。</p>\n<h2 id=\"copy\">Copy<a href=\"#copy\" title=\"Copy\"></a></h2><p>用于将文件从主控端复制到被控端。</p>\n<p><strong>参数</strong></p>\n<ul><li><code>src</code>源文件（软连接文件会复制源文件）</li>\n<li><code>dest</code>目的文件</li>\n<li><code>backup</code>若目的文件存在是否进行备份</li>\n<li><code>content</code>手动指定内容</li>\n<li><code>group</code>文件属组</li>\n<li><code>owner</code>文件所有者</li>\n<li><code>mode</code>文件权限（如0777，前面需要加0）</li>\n<li><code>remote_src</code><ul><li><code>no</code>将本机上的文件分发到远程主机</li>\n<li><code>yes</code>复制远程主机上的文件</li>\n</ul></li>\n</ul><p><strong>示例</strong></p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible mq -m copy -a <span class=\"string\">'src=./hello.txt dest=~/hello.txt mode=0777'</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"fetch\">Fetch<a href=\"#fetch\" title=\"Fetch\"></a></h2><p>用于抓取远程机器上的文件。</p>\n<p><strong>参数</strong></p>\n<ul><li><code>src</code>要复制的文件</li>\n<li><code>dest</code>本机用于保存文件的目录</li>\n</ul><p><strong>示例</strong></p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible mq -m fetch -a <span class=\"string\">'src=~/hello.txt dest=./fetch'</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"file\">File<a href=\"#file\" title=\"File\"></a></h2><p>创建、删除文件 对文件权限进行修改。</p>\n<p><strong>参数</strong></p>\n<ul><li><code>path</code>要操作的文件路径</li>\n<li><code>group</code>文件属组</li>\n<li><code>owner</code>文件所有者</li>\n<li><code>mode</code>文件权限</li>\n<li><code>recurse</code>是否递归设置</li>\n<li><code>src</code>创建软连接的源</li>\n<li><code>state</code><ul><li><code>absent</code>删除文件</li>\n<li><code>directory</code>创建目录</li>\n<li><code>file</code>即使文件不存在，也不会创建</li>\n<li><code>link</code>软链接</li>\n<li><code>hard</code>硬链接</li>\n<li><code>touch</code>如果文件不存在，则会创建一个新的文件，如果文件或目录已存在，则更新其最后修改时间</li>\n</ul></li>\n</ul><p><strong>示例</strong></p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible mq -m file -a <span class=\"string\">'path=~/hello.txt state=absent'</span></span><br><span class=\"line\">``` </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## Yum</span></span><br><span class=\"line\"></span><br><span class=\"line\">用于使用包管理器`yum`</span><br><span class=\"line\"></span><br><span class=\"line\">**参数**</span><br><span class=\"line\"></span><br><span class=\"line\">- `name`软件包名称</span><br><span class=\"line\">- `state`</span><br><span class=\"line\">  - `removed`删除</span><br><span class=\"line\">  - `installed`安装</span><br><span class=\"line\">  - `latest`升级到最新</span><br><span class=\"line\"></span><br><span class=\"line\">**示例**</span><br><span class=\"line\"></span><br><span class=\"line\">```bash</span><br><span class=\"line\">ansible mq -m yum -a <span class=\"string\">'name=vim state=removed'</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"service\">Service<a href=\"#service\" title=\"Service\"></a></h2><p>用于管理服务。</p>\n<p><strong>参数</strong></p>\n<ul><li><code>name</code>服务名称</li>\n<li><code>enabled</code>是否开机启动</li>\n<li><code>state</code><ul><li><code>reloaded</code>平滑重启</li>\n<li><code>restarted</code>重启</li>\n<li><code>started</code>启动</li>\n<li><code>stopped</code>停止</li>\n</ul></li>\n</ul><h2 id=\"cron\">Cron<a href=\"#cron\" title=\"Cron\"></a></h2><p>管理定时任务。</p>\n<p><strong>参数</strong></p>\n<ul><li><code>name</code>注释信息</li>\n<li><code>minute/hour/day/month/weekday</code>设置时间<ul><li><code>*</code> 取值范围内的所有数字</li>\n<li><code>/</code> 每过多少个数字</li>\n<li><code>-</code>从X到Z</li>\n<li><code>，</code>并列</li>\n</ul></li>\n<li><code>job</code>要执行的任务</li>\n<li><code>disabled</code>是否注释定时任务</li>\n<li><code>state</code><ul><li><code>present</code>创建定时任务</li>\n<li><code>absent</code>删除定时任务</li>\n</ul></li>\n</ul><p><strong>示例</strong></p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ansible mq -m cron -a <span class=\"string\">'name=echo minute=*/1 hour=* day=* month=* weekday=* job=\"echo hello &gt;&gt; ~/cron.txt\" state=present'</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"group\">Group<a href=\"#group\" title=\"Group\"></a></h2><p>创建或删除用户组信息。</p>\n<p><strong>参数</strong></p>\n<ul><li><code>name</code>组名称</li>\n<li><code>gid</code>组<code>id</code></li>\n<li><code>state</code><ul><li><code>present</code>创建组</li>\n<li><code>absent</code>删除组</li>\n</ul></li>\n</ul><h2 id=\"user\">User<a href=\"#user\" title=\"User\"></a></h2><p>创建或删除用户信息。</p>\n<p><strong>参数</strong></p>\n<ul><li><code>name</code>用户名</li>\n<li><code>password</code>密码</li>\n<li><code>uid</code>用户<code>id</code></li>\n<li><code>group</code>用户基本组</li>\n<li><code>groups</code>用户附加组</li>\n<li><code>home</code>用户的家目录</li>\n<li><code>system</code>是否建立系统用户</li>\n<li><code>shell</code><ul><li><code>/bin/bash</code>可以登陆</li>\n<li><code>/sbin/nologin</code>无法登陆</li>\n</ul></li>\n<li><code>state</code><ul><li><code>present</code>创建</li>\n<li><code>absent</code>删除</li>\n</ul></li>\n</ul><h2 id=\"unarchive\">Unarchive<a href=\"#unarchive\" title=\"Unarchive\"></a></h2><p>用于解压。</p>\n<p><strong>参数</strong></p>\n<ul><li><code>src</code>压缩包路径</li>\n<li><code>dest</code>远程主机上的一个路径，即文件解压的路径</li>\n<li><code>creates</code>若指定的文件存在，则不解压</li>\n<li><code>copy</code>解压前是否将文件复制到远程主机（若为no，则压缩包必须存在于远程主机上）</li>\n<li><code>group</code>解压文件的属组</li>\n<li><code>owner</code>解压文件的属主</li>\n<li><code>mode</code>解压文件的权限</li>\n</ul>","prev":{"title":"3-Ansible之Playbook","link":"post/自动化运维/Ansible/3-Ansible之Playbook"},"next":{"title":"1-Ansible入门","link":"post/自动化运维/Ansible/1-Ansible入门"},"plink":"https://beginc.github.io/post/自动化运维/Ansible/2-Ansible模块/","toc":[{"id":"模块概述","title":"模块概述","index":"1"},{"id":"ansible","title":"Ansible","index":"2","children":[{"id":"调用格式","title":"调用格式","index":"2.1"}]},{"id":"常用模块","title":"常用模块","index":"3","children":[{"id":"command","title":"command","index":"3.1"},{"id":"shell","title":"Shell","index":"3.2"},{"id":"copy","title":"Copy","index":"3.3"},{"id":"fetch","title":"Fetch","index":"3.4"},{"id":"file","title":"File","index":"3.5"},{"id":"service","title":"Service","index":"3.6"},{"id":"cron","title":"Cron","index":"3.7"},{"id":"group","title":"Group","index":"3.8"},{"id":"user","title":"User","index":"3.9"},{"id":"unarchive","title":"Unarchive","index":"3.10"}]}]}