{"title":"TCP状态转换","date":"2020-02-28T04:23:35.000Z","date_formatted":{"ll":"Feb 28, 2020","L":"02/28/2020","MM-DD":"02-28"},"thumbnail":"post/计算机网络/TCP状态转换/cover.jpg","link":"post/计算机网络/TCP状态转换","categories":["计算机网络"],"updated":"2020-02-29T16:14:21.972Z","content":"<h1 id=\"tcp状态转换图\">TCP状态转换图<a href=\"#tcp状态转换图\" title=\"TCP状态转换图\"></a></h1><img src=\"/post/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/TCP%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2/v2-6f9df774863050b92cdd3810e6819a7c_r.jpg\" class=\"\">\n\n<img src=\"/post/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/TCP%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2/v2-a2e876e218b1d29c3d181647e902ed1e_720w.jpg\" class=\"\">\n\n<h1 id=\"time_wait作用\">TIME_WAIT作用<a href=\"#time_wait作用\" title=\"TIME_WAIT作用\"></a></h1><p>在客户端发送了最后一个ACK挥手包后，会进入时长为2MSL（最大报文段生存时间，在网络传输中超过这个时间的报文段将被丢弃）的TIME_WAIT状态，之后再完全关闭连接，主要有以下两点原因</p>\n<p><strong>保证最后一个ACK挥手包被服务端接收到</strong></p>\n<p>最后一个ACK挥手包可能会发生丢失，若客户端发送完后直接进入关闭状态，则当服务端重发第三次FIN挥手包时，客户端会发生异常，直接回复一个RST包重置连接。因此必须等待一个MSL的时间保证自己能够回复重发的FIN挥手包，正确关闭连接。</p>\n<img src=\"/post/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/TCP%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2/v2-1089c252023a221bad42f68c91f54adc_720w.jpg\" class=\"\">\n\n<p><strong>保证旧连接的网络包在网络中完全消失</strong></p>\n<p>旧连接的网络包有可能由于网络原因，在网络中徘徊后迟到到达客户端，若客户端直接关闭连接后，又与相同的服务端在相同的端口建立了TCP连接（称为一个化身），那么客户端会误以为这个旧的包时现在的连接上所传输的包，导致数据错乱，因此必须再等待一个MSL，保证其在网络中消失。</p>\n<h1 id=\"参考\">参考<a href=\"#参考\" title=\"参考\"></a></h1><ol><li><a href=\"https://zhuanlan.zhihu.com/p/99943313\" target=\"_blank\">TCP的TIME_WAIT状态</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/78540103\" target=\"_blank\">TCP状态转换图总结</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/77334450\" target=\"_blank\">成为高手前必懂的TCP干货</a></li>\n</ol>","prev":{"title":"TCP连接队列","link":"post/计算机网络/TCP连接队列"},"next":{"title":"TCP三次握手四次挥手","link":"post/计算机网络/TCP三次握手四次挥手"},"plink":"https://beginc.github.io/post/计算机网络/TCP状态转换/","toc":[{"id":"tcp状态转换图","title":"TCP状态转换图","index":"1"},{"id":"time_wait作用","title":"TIME_WAIT作用","index":"2"},{"id":"参考","title":"参考","index":"3"}]}