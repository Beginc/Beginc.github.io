{"title":"mybatis动态代理开发","date":"2019-08-23T15:52:46.000Z","thumbnail":"/post/mybatis动态代理开发/cover.jpg","link":"post/mybatis动态代理开发","updated":"2019-08-23T16:11:08.247Z","content":"<h1 id=\"环境搭建\">环境搭建<a href=\"post/mybatis动态代理开发#环境搭建\"></a></h1><p>详见<a href=\"/post/mybatis入门/\" title=\"mybatis入门\">mybatis入门</a></p>\n<ul>\n<li>创建Maven项目</li>\n<li>引入依赖</li>\n<li>配置SqlMapConfig.xml</li>\n<li>建立pojo对象</li>\n<li>为pojo对象建立SqlMap配置文件</li>\n</ul>\n<h1 id=\"MyBatis动态代理开发规范\">MyBatis动态代理开发规范<a href=\"post/mybatis动态代理开发#MyBatis动态代理开发规范\"></a></h1><ul>\n<li>mapper方法名与SqlMap文件中对应statement的id一致</li>\n<li>mapper返回值类型与SqlMap文件中对应statement的返回类型一致</li>\n<li>mapper参数类型与SqlMap文件中对应statement的参数类型一致</li>\n<li><strong>SqlMap中namespace必须为Mapper接口的全称</strong></li>\n</ul>\n<h1 id=\"建立UserMapper\">建立UserMapper<a href=\"post/mybatis动态代理开发#建立UserMapper\"></a></h1><p>新建包<code>mapper</code>, 建立<code>UserMapper</code>接口</p>\n<figure class=\"highlight java\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">UserMapper</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> User <span class=\"title\">findById</span><span class=\"params\">(Integer id)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> List&lt;User&gt; <span class=\"title\">findByName</span><span class=\"params\">(String name)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">insertUser</span><span class=\"params\">(User user)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">updateUser</span><span class=\"params\">(User user)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">deleteUser</span><span class=\"params\">(Integer id)</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n<h1 id=\"修改User-xml中的namespace\">修改User.xml中的namespace<a href=\"post/mybatis动态代理开发#修改User-xml中的namespace\"></a></h1><figure class=\"highlight xml\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE mapper</span></span><br><span class=\"line\"><span class=\"meta\">PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"</span></span><br><span class=\"line\"><span class=\"meta\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"mapper.UserMapper\"</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findById\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"Integer\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"pojo.User\"</span>&gt;</span></span><br><span class=\"line\">\t\tselect * from user where id = #&#123;value&#125;</span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findByName\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"String\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"pojo.User\"</span>&gt;</span></span><br><span class=\"line\">\t\tselect * from user where name like '%$&#123;value&#125;%'</span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">insert</span> <span class=\"attr\">id</span>=<span class=\"string\">\"insertUser\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"pojo.User\"</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">selectKey</span> <span class=\"attr\">keyProperty</span>=<span class=\"string\">\"id\"</span> <span class=\"attr\">order</span>=<span class=\"string\">\"AFTER\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"Integer\"</span>&gt;</span></span><br><span class=\"line\">\t\t\tselect LAST_INSERT_ID()</span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">selectKey</span>&gt;</span></span><br><span class=\"line\">\t\tinsert into user (name, age) values (#&#123;name&#125;, #&#123;age&#125;)</span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">insert</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">update</span> <span class=\"attr\">id</span>=<span class=\"string\">\"updateUser\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"pojo.User\"</span>&gt;</span></span><br><span class=\"line\">\t\tupdate user set name=#&#123;name&#125;, age=#&#123;age&#125; where id=#&#123;id&#125;</span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">update</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">delete</span> <span class=\"attr\">id</span>=<span class=\"string\">\"deleteUser\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"Integer\"</span>&gt;</span></span><br><span class=\"line\">\t\tdelete from user where id=#&#123;value&#125;</span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">delete</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></span><br></pre></td></tr></table></div></figure>\n\n<h1 id=\"编写测试\">编写测试<a href=\"post/mybatis动态代理开发#编写测试\"></a></h1><ul>\n<li>通过SqlSession获取Mapper</li>\n<li>调用Mapper的方法</li>\n</ul>\n<figure class=\"highlight java\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Test02</span> </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\"><span class=\"keyword\">private</span> SqlSessionFactory factory;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Before</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUp</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>.factory = <span class=\"keyword\">new</span> SqlSessionFactoryBuilder().build(Resources.getResourceAsStream(<span class=\"string\">\"SqlMapConfig.xml\"</span>));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Test</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test01</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tSqlSession session = <span class=\"keyword\">this</span>.factory.openSession();</span><br><span class=\"line\">\t\tUserMapper mapper = session.getMapper(UserMapper.class);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\tUser user = mapper.findById(<span class=\"number\">7</span>);</span><br><span class=\"line\">\t\tSystem.out.println(user);</span><br><span class=\"line\">\t\tsession.close();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Test</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test02</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tSqlSession session = <span class=\"keyword\">this</span>.factory.openSession();</span><br><span class=\"line\">\t\tUserMapper mapper = session.getMapper(UserMapper.class);</span><br><span class=\"line\">\t\tList&lt;User&gt; users = mapper.findByName(<span class=\"string\">\"Rylynn\"</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (User user : users) &#123;</span><br><span class=\"line\">\t\t\tSystem.out.println(user);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tsession.close();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Test</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test03</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tSqlSession session = <span class=\"keyword\">this</span>.factory.openSession();</span><br><span class=\"line\">\t\tUserMapper mapper = session.getMapper(UserMapper.class);</span><br><span class=\"line\">\t\tUser user = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">\t\tuser.setName(<span class=\"string\">\"BCD\"</span>);</span><br><span class=\"line\">\t\tuser.setAge(<span class=\"number\">50</span>);</span><br><span class=\"line\">\t\tmapper.insertUser(user);</span><br><span class=\"line\">\t\tSystem.out.println(user);</span><br><span class=\"line\">\t\tsession.commit();</span><br><span class=\"line\">\t\tsession.close();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Test</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test04</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tSqlSession session = <span class=\"keyword\">this</span>.factory.openSession();</span><br><span class=\"line\">\t\tUserMapper mapper = session.getMapper(UserMapper.class);</span><br><span class=\"line\">\t\tUser user = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">\t\tuser.setId(<span class=\"number\">5</span>);</span><br><span class=\"line\">\t\tuser.setName(<span class=\"string\">\"BCD\"</span>);</span><br><span class=\"line\">\t\tuser.setAge(<span class=\"number\">57</span>);</span><br><span class=\"line\">\t\tmapper.updateUser(user);</span><br><span class=\"line\">\t\tsession.commit();</span><br><span class=\"line\">\t\tsession.close();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"meta\">@Test</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">test05</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tSqlSession session = <span class=\"keyword\">this</span>.factory.openSession();</span><br><span class=\"line\">\t\tUserMapper mapper = session.getMapper(UserMapper.class);</span><br><span class=\"line\">\t\tmapper.deleteUser(<span class=\"number\">8</span>);</span><br><span class=\"line\">\t\tsession.commit();</span><br><span class=\"line\">\t\tsession.close();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n","next":{"title":"mybatis入门","link":"post/mybatis入门"},"plink":"https://beginc.github.io/post/mybatis动态代理开发/","toc":[{"title":"环境搭建","id":"环境搭建","index":"1"},{"title":"MyBatis动态代理开发规范","id":"MyBatis动态代理开发规范","index":"2"},{"title":"建立UserMapper","id":"建立UserMapper","index":"3"},{"title":"修改User.xml中的namespace","id":"修改User-xml中的namespace","index":"4"},{"title":"编写测试","id":"编写测试","index":"5"}]}