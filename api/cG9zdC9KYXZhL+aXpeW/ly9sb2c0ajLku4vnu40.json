{"title":"log4j2介绍","date":"2020-01-28T09:05:24.000Z","date_formatted":{"ll":"Jan 28, 2020","L":"01/28/2020","MM-DD":"01-28"},"thumbnail":"post/Java/日志/log4j2介绍/cover.jpg","link":"post/Java/日志/log4j2介绍","categories":["Java","日志"],"updated":"2020-02-08T02:39:27.130Z","content":"<h1 id=\"包介绍\">包介绍<a href=\"#包介绍\" title=\"包介绍\"></a></h1><ul><li><code>log4j-api</code>包含了<code>API</code></li>\n<li><code>log4j-core</code>核心包（根据不同的需求有额外的依赖）</li>\n</ul><img src=\"/post/Java/%E6%97%A5%E5%BF%97/log4j2%E4%BB%8B%E7%BB%8D/4.png\" class=\"\">\n\n<h1 id=\"架构\">架构<a href=\"#架构\" title=\"架构\"></a></h1><h2 id=\"组件\">组件<a href=\"#组件\" title=\"组件\"></a></h2><p>基本和<a href=\"/post/Java/%E6%97%A5%E5%BF%97/Java%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6%E6%A6%82%E5%86%B5/\" title=\"Java日志框架概况\">Java日志框架概况</a>中说明的组件相同（名称等略有不同）。</p>\n<img src=\"/post/Java/%E6%97%A5%E5%BF%97/log4j2%E4%BB%8B%E7%BB%8D/1.jpg\" class=\"\">\n\n<h2 id=\"层次性\">层次性<a href=\"#层次性\" title=\"层次性\"></a></h2><p>遵从<a href=\"/post/Java/%E6%97%A5%E5%BF%97/Java%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6%E6%A6%82%E5%86%B5/\" title=\"Java日志框架概况\">Java日志框架概况</a>说明的层次性。</p>\n<h1 id=\"配置\">配置<a href=\"#配置\" title=\"配置\"></a></h1><h2 id=\"配置文件查找顺序\">配置文件查找顺序<a href=\"#配置文件查找顺序\" title=\"配置文件查找顺序\"></a></h2><ol><li><p>查找名为<code>log4j.configurationFile</code>的<code>System Property</code>对应的配置文件。</p>\n</li>\n<li><p>查找<code>classpath:log4j2-test.properties</code></p>\n</li>\n<li><p>查找<code>classpath:log4j2-test.yaml</code>或<code>classpath:log4j2-test.yaml</code></p>\n</li>\n<li><p>查找<code>classpath:log4j2-test.json</code>或<code>classpath:log4j2-test.jsn</code></p>\n</li>\n<li><p>查找<code>classpath:log4j2-test.xml</code></p>\n</li>\n<li><p>查找<code>classpath:log4j2.properties</code></p>\n</li>\n<li><p>查找<code>classpath:log4j2.yaml</code>或<code>classpath:log4j2.yaml</code></p>\n</li>\n<li><p>查找<code>classpath:log4j2.json</code>或<code>classpath:log4j2.jsn</code></p>\n</li>\n<li><p>查找<code>classpath:log4j2.xml</code></p>\n</li>\n<li><p>使用默认配置</p>\n</li>\n</ol><ul><li><code>ConsoleAppender</code>添加到<code>RootLogger</code></li>\n<li><code>PatternLayout</code>添加到<code>RootLogger</code></li>\n<li><code>RootLogger</code>的<code>Level</code>为<code>ERROR</code></li>\n</ul><h2 id=\"配置模板\">配置模板<a href=\"#配置模板\" title=\"配置模板\"></a></h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span>;</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Configuration</span>&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--定义变量--&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">Properties</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"变量名\"</span>&gt;</span>变量值<span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">Properties</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">Filter名</span> 属性<span class=\"attr\">1</span>=<span class=\"string\">\"值\"</span> 属性<span class=\"attr\">2</span>=<span class=\"string\">\"值\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">Filter名</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">Appenders</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Appender名</span> 属性<span class=\"attr\">1</span>=<span class=\"string\">\"值\"</span> 属性<span class=\"attr\">2</span>=<span class=\"string\">\"值\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">Filter名</span> 属性<span class=\"attr\">1</span>=<span class=\"string\">\"值\"</span> 属性<span class=\"attr\">2</span>=<span class=\"string\">\"值\"</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">Filter名</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">Layout名</span> 属性<span class=\"attr\">1</span>=<span class=\"string\">\"值\"</span> 属性<span class=\"attr\">2</span>=<span class=\"string\">\"值\"</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">Layout名</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">Appender名</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">Appenders</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">Loggers</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Logger</span> <span class=\"attr\">name</span>=<span class=\"string\">\"logger\"</span> <span class=\"attr\">level</span>=<span class=\"string\">\"info\"</span> <span class=\"attr\">addictivity</span>=<span class=\"string\">\"false\"</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">Filter名</span> 属性<span class=\"attr\">1</span>=<span class=\"string\">\"值\"</span> 属性<span class=\"attr\">2</span>=<span class=\"string\">\"值\"</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">Filter名</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">AppenderRef</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"name\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">Filter名</span> 属性<span class=\"attr\">1</span>=<span class=\"string\">\"值\"</span> 属性<span class=\"attr\">2</span>=<span class=\"string\">\"值\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">Filter名</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">AppenderRef</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">Logger</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Root</span> <span class=\"attr\">level</span>=<span class=\"string\">\"error\"</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">AppenderRef</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"name\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">Root</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">Loggers</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"常用appender\">常用Appender<a href=\"#常用appender\" title=\"常用Appender\"></a></h1><h2 id=\"consoleappender\">ConsoleAppender<a href=\"#consoleappender\" title=\"ConsoleAppender\"></a></h2><p>输出到控制台。</p>\n<p><strong>target</strong></p>\n<ul><li><code>SYSTEM_OUT</code></li>\n<li><code>SYSTEM_ERROR</code></li>\n</ul><h2 id=\"fileappender\">FileAppender<a href=\"#fileappender\" title=\"FileAppender\"></a></h2><p>输出到文件。</p>\n<p><strong>append</strong>\n是否追加。</p>\n<p><strong>bufferedIO</strong>\n是否写日志先写到缓冲区，满了再写到磁盘，可提高性能。</p>\n<p><strong>bufferSize</strong>\n缓冲区大小。</p>\n<p><strong>createOnDemand</strong>\n是否在真正写日志时再创建文件。</p>\n<p><strong>fileName</strong>\n文件名。</p>\n<p><strong>immediateFlush</strong>\n每次写到缓冲区都会马上刷新。</p>\n<p><strong>locking</strong>\n是否写时上锁。会极大影响性能。</p>\n<h2 id=\"rollingfileappender\">RollingFileAppender<a href=\"#rollingfileappender\" title=\"RollingFileAppender\"></a></h2><p>输出到文件，可指定何时进行滚动。（<code>FileAppender</code>的属性都有）</p>\n<p><strong>policy</strong>\n决定是否发生滚动。</p>\n<p><strong>strategy</strong>\n决定滚动产生的文件的位置和名称。</p>\n<h1 id=\"常用filter\">常用Filter<a href=\"#常用filter\" title=\"常用Filter\"></a></h1><h2 id=\"burstfilter\">BurstFilter<a href=\"#burstfilter\" title=\"BurstFilter\"></a></h2><p>控制每秒打印的日志数量。</p>\n<p><strong>level</strong>\n低于或等于该级别的日志会被过滤。</p>\n<p><strong>rate</strong>\n允许的日志输出速率。</p>\n<p><strong>maxBurst</strong>\n最大排队日志数量，默认为<code>rate * 10</code>, 当超过该数量时，日志将会被丢弃。</p>\n<p><strong>onMatch</strong>\n符合条件时的行为</p>\n<ul><li><code>ACCEPT</code>通过</li>\n<li><code>DENY</code>拒绝（过滤掉）</li>\n<li><code>NEUTRAL</code>（交给其他过滤器继续决定）</li>\n</ul><p><strong>onMismatch</strong>\n不符合条件时的行为</p>\n<ul><li><code>ACCEPT</code>通过</li>\n<li><code>DENY</code>拒绝（过滤掉）</li>\n<li><code>NEUTRAL</code>（交给其他过滤器继续决定）</li>\n</ul><h1 id=\"常用layout\">常用Layout<a href=\"#常用layout\" title=\"常用Layout\"></a></h1><h2 id=\"html-layout\">HTML Layout<a href=\"#html-layout\" title=\"HTML Layout\"></a></h2><p>输出成<code>HTML</code>的形式，每条日志都在一个<code>table</code>中。</p>\n<p><strong>charset</strong>\n字符集。</p>\n<p><strong>title</strong>\n标题。</p>\n<p><strong>fontName</strong>\n字体名。</p>\n<p><strong>fontSize</strong>\n字体大小。</p>\n<h2 id=\"json-layout\">JSON Layout<a href=\"#json-layout\" title=\"JSON Layout\"></a></h2><p>输出成<code>JSON</code>格式。</p>\n<p><strong>charset</strong>\n字符集。</p>\n<p><strong>compact</strong>\n紧凑形式，设置<code>compact</code>和<code>eventEol</code>都为<code>true</code>，则为一条记录占一行。</p>\n<p><strong>complete</strong>\n若为<code>false</code>，将省略数组的<code>[]</code>和隔开字段的<code>,</code>。</p>\n<p><strong>objectMessageAsJsonObject</strong>\n若为<code>true</code>，则<code>ObjectMessage</code>将会被序列化成<code>JSON</code>。</p>\n<h2 id=\"pattern-layout\">Pattern Layout<a href=\"#pattern-layout\" title=\"Pattern Layout\"></a></h2><p>格式化输出。</p>\n<p><strong>charset</strong>\n字符集。</p>\n<p><strong>pattern</strong>\n指定格式。</p>\n<ul><li><p><code>%logger{precision}</code>\n输出<code>Logger</code>名称</p>\n<img src=\"/post/Java/%E6%97%A5%E5%BF%97/log4j2%E4%BB%8B%E7%BB%8D/2.png\" class=\"\">\n</li>\n<li><p><code>%class{precision}</code>\n输出调用者全限定类名</p>\n</li>\n<li><p><code>%date{pattern}</code>\n输出日期</p>\n<img src=\"/post/Java/%E6%97%A5%E5%BF%97/log4j2%E4%BB%8B%E7%BB%8D/3.png\" class=\"\">\n</li>\n<li><p><code>%msg</code>\n日志信息。</p>\n</li>\n<li><p><code>%method</code>\n方法名</p>\n</li>\n<li><p><code>%pid</code>\n进程<code>id</code></p>\n</li>\n<li><p><code>%tid</code>\n线程<code>id</code></p>\n</li>\n<li><p><code>%level</code></p>\n</li>\n</ul><p>日志级别</p>\n","prev":{"title":"log4j介绍","link":"post/Java/日志/log4j介绍"},"next":{"title":"commons-logging介绍","link":"post/Java/日志/commons-logging介绍"},"plink":"https://beginc.github.io/post/Java/日志/log4j2介绍/","toc":[{"id":"包介绍","title":"包介绍","index":"1"},{"id":"架构","title":"架构","index":"2","children":[{"id":"组件","title":"组件","index":"2.1"},{"id":"层次性","title":"层次性","index":"2.2"}]},{"id":"配置","title":"配置","index":"3","children":[{"id":"配置文件查找顺序","title":"配置文件查找顺序","index":"3.1"},{"id":"配置模板","title":"配置模板","index":"3.2"}]},{"id":"常用appender","title":"常用Appender","index":"4","children":[{"id":"consoleappender","title":"ConsoleAppender","index":"4.1"},{"id":"fileappender","title":"FileAppender","index":"4.2"},{"id":"rollingfileappender","title":"RollingFileAppender","index":"4.3"}]},{"id":"常用filter","title":"常用Filter","index":"5","children":[{"id":"burstfilter","title":"BurstFilter","index":"5.1"}]},{"id":"常用layout","title":"常用Layout","index":"6","children":[{"id":"html-layout","title":"HTML Layout","index":"6.1"},{"id":"json-layout","title":"JSON Layout","index":"6.2"},{"id":"pattern-layout","title":"Pattern Layout","index":"6.3"}]}]}