{"title":"Java注解","date":"2019-08-29T14:02:41.000Z","thumbnail":"/post/Java注解/cover.jpg","link":"post/Java注解","tags":["注解"],"categories":["Java"],"updated":"2019-08-29T15:15:20.000Z","content":"<h1 id=\"注解简介\">注解简介<a href=\"post/Java注解#注解简介\"></a></h1><p>注解只是一种特殊的注释，不对代码逻辑产生任何影响，具体的作用取决于程序如何使用这个注释信息。</p>\n<h2 id=\"注解的作用\">注解的作用<a href=\"post/Java注解#注解的作用\"></a></h2><p><strong>编译器使用的注解</strong><br>编译后即被丢弃，不会进入<code>.class</code>文件</p>\n<ul>\n<li><code>@Override</code>编译器检查方法是否正确实现了重载</li>\n<li><code>@SupressWarnings</code>告诉编译器忽略此处的警告</li>\n</ul>\n<p><strong>工具处理</strong><br>有些工具会在加载<code>class</code>的时候，对<code>class</code>做动态修改，实现一些特殊的功能。这类注解会被编译进入<code>.class</code>文件，但加载结束后并不会存在于内存中。</p>\n<p><strong>运行期可读取</strong><br>此类注解在程序运行期能够读取的注解，它们在加载后一直存在于JVM中，这也是最常用的注解。</p>\n<h2 id=\"注解的参数\">注解的参数<a href=\"post/Java注解#注解的参数\"></a></h2><p>注解可配置一些基本参数。大部分注解会有一个名为value的配置参数，对此参数赋值，可以只写常量，相当于省略了value参数。</p>\n<ul>\n<li>所有基本类型</li>\n<li><code>String</code></li>\n<li>枚举类型</li>\n</ul>\n<h1 id=\"定义注解\">定义注解<a href=\"post/Java注解#定义注解\"></a></h1><h2 id=\"基本定义\">基本定义<a href=\"post/Java注解#基本定义\"></a></h2><ul>\n<li><code>@interface</code>定义注解</li>\n<li><code>类型 名字() default 值</code>定义参数</li>\n</ul>\n<figure class=\"highlight java\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> Report &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">type</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> 0</span>;</span><br><span class=\"line\">    <span class=\"function\">String <span class=\"title\">level</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> \"info\"</span>;</span><br><span class=\"line\">    <span class=\"function\">String <span class=\"title\">value</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> \"\"</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n<h1 id=\"元注解\">元注解<a href=\"post/Java注解#元注解\"></a></h1><p>元注解负责修饰注解，对注解进行一些配置</p>\n<p><strong>@Target</strong><br>指定注解可以放的位置(<strong>必配置</strong>)</p>\n<ul>\n<li><code>ElementType.TYPE</code>类或接口</li>\n<li><code>ElementType.FIELD</code>字段</li>\n<li><code>ElementType.METHOD</code>方法</li>\n<li><code>ElementType.CONSTRUCTOR</code>构造方法</li>\n<li><code>ElementType.PARAMETER</code>方法参数</li>\n</ul>\n<figure class=\"highlight java\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 只能加在方法上</span></span><br><span class=\"line\"><span class=\"meta\">@Target</span>(ElementType.METHOD)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> Report &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">type</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> 0</span>;</span><br><span class=\"line\">    <span class=\"function\">String <span class=\"title\">level</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> \"info\"</span>;</span><br><span class=\"line\">    <span class=\"function\">String <span class=\"title\">value</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> \"\"</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 加在多个位置上</span></span><br><span class=\"line\"><span class=\"meta\">@Target</span>(&#123;</span><br><span class=\"line\">    ElementType.METHOD,</span><br><span class=\"line\">    ElementType.FIELD</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> Report &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n<p><strong>@Retention</strong><br>定义注解的生命周期(<strong>必配置</strong>)</p>\n<ul>\n<li><code>RetentionPolicy.SOURCE</code>注解在编译期就被丢掉了</li>\n<li><code>RetentionPolicy.CLASS</code>注解仅保存在class文件中，它们不会被加载进JVM(默认)</li>\n<li><code>RetentionPolicy.RUNTIME</code>注解会被加载进JVM，并且在运行期可以被程序读取</li>\n</ul>\n<p><strong>@Repeatable</strong><br>定义注解是否可重复进行注解</p>\n<figure class=\"highlight java\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Repeatable</span></span><br><span class=\"line\"><span class=\"meta\">@Target</span>(ElementType.TYPE)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> Report &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">type</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> 0</span>;</span><br><span class=\"line\">    <span class=\"function\">String <span class=\"title\">level</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> \"info\"</span>;</span><br><span class=\"line\">    <span class=\"function\">String <span class=\"title\">value</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> \"\"</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Report</span>(type=<span class=\"number\">1</span>, level=<span class=\"string\">\"debug\"</span>)</span><br><span class=\"line\"><span class=\"meta\">@Report</span>(type=<span class=\"number\">2</span>, level=<span class=\"string\">\"warning\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Hello</span> </span>&#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n<p><strong>@Inherited</strong><br>定义子类是否可以继承父类的注解，仅针对<code>@Target(ElementType.TYPE)</code>有效</p>\n<h1 id=\"使用注解\">使用注解<a href=\"post/Java注解#使用注解\"></a></h1><h2 id=\"RetentionPolicy-SOURCE-暂不讨论\">RetentionPolicy.SOURCE(暂不讨论)<a href=\"post/Java注解#RetentionPolicy-SOURCE-暂不讨论\"></a></h2><h2 id=\"RetentionPolicy-CLASS-暂不讨论\">RetentionPolicy.CLASS(暂不讨论)<a href=\"post/Java注解#RetentionPolicy-CLASS-暂不讨论\"></a></h2><h2 id=\"RetentionPolicy-RUNTIME\">RetentionPolicy.RUNTIME<a href=\"post/Java注解#RetentionPolicy-RUNTIME\"></a></h2><p><strong>获取注解</strong><br>详见<a href=\"/post/Java反射/\" title=\"Java反射\">Java反射</a></p>\n<p><strong>使用注解</strong><br>如何使用注解完全取决于程序的目的</p>\n<figure class=\"highlight java\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Target</span>(ElementType.TYPE)</span><br><span class=\"line\"><span class=\"meta\">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class=\"line\"><span class=\"meta\">@interface</span> OptimizerConfig&#123;</span><br><span class=\"line\">    <span class=\"function\">String <span class=\"title\">type</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> \"SGD\"</span>;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">double</span> <span class=\"title\">lr</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> 0.02</span>;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">epoch</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> 12</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@OptimizerConfig</span>(type=<span class=\"string\">\"SGD\"</span>, lr=<span class=\"number\">0.01</span>, epoch=<span class=\"number\">20</span>)</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Model</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String type = <span class=\"string\">\"SGD\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">double</span> lr = <span class=\"number\">0.02</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> epoch = <span class=\"number\">12</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Model</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        Class cls = getClass();</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(cls.isAnnotationPresent(OptimizerConfig.class))&#123;</span><br><span class=\"line\">            OptimizerConfig config = (OptimizerConfig) cls.getAnnotation(OptimizerConfig.class);</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.type =  config.type();</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.lr = config.lr();</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.epoch = config.epoch();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Running with config:\"</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Type:\"</span> + type);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Lr:\"</span> + lr);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Epoch:\"</span> + epoch);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n","next":{"title":"SpringIoC容器","link":"post/Spring IoC容器"},"plink":"https://beginc.github.io/post/Java注解/","toc":[{"title":"注解简介","id":"注解简介","index":"1","children":[{"title":"注解的作用","id":"注解的作用","index":"1.1"},{"title":"注解的参数","id":"注解的参数","index":"1.2"}]},{"title":"定义注解","id":"定义注解","index":"2","children":[{"title":"基本定义","id":"基本定义","index":"2.1"}]},{"title":"元注解","id":"元注解","index":"3"},{"title":"使用注解","id":"使用注解","index":"4","children":[{"title":"RetentionPolicy.RUNTIME","id":"RetentionPolicy-RUNTIME","index":"4.1"}]}]}