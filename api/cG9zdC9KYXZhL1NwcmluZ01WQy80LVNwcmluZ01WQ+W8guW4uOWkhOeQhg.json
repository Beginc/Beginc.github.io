{"title":"4-SpringMVC异常处理","date":"2020-02-05T09:05:59.000Z","date_formatted":{"ll":"Feb 5, 2020","L":"02/05/2020","MM-DD":"02-05"},"thumbnail":"post/Java/SpringMVC/4-SpringMVC异常处理/cover.png","link":"post/Java/SpringMVC/4-SpringMVC异常处理","categories":["Java","SpringMVC"],"updated":"2020-02-08T02:43:23.604Z","content":"<h1 id=\"异常处理概述\">异常处理概述<a href=\"#异常处理概述\" title=\"异常处理概述\"></a></h1><p>在三层项目中，若我们在每一层都对发生的异常进行<code>try catch</code>单独处理，则会导致代码异常处理十分混乱不易于管理。因此较好的做法是，在<code>DAO</code>层和<code>Service</code>层以及<code>Controller</code>层产生的异常我们都不做处理，而是直接向上抛出，最后再为<code>Controller</code>层配置一个统一的异常处理器，对异常进行集中处理。</p>\n<h1 id=\"方式一：handlerexceptionresolver\">方式一：HandlerExceptionResolver<a href=\"#方式一：handlerexceptionresolver\" title=\"方式一：HandlerExceptionResolver\"></a></h1><h2 id=\"自定义异常处理器\">自定义异常处理器<a href=\"#自定义异常处理器\" title=\"自定义异常处理器\"></a></h2><ul><li>实现<code>HandlerExceptionResolver</code>接口</li>\n<li>重写<code>resolveException</code>方法</li>\n</ul><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExceptionResolver</span> <span class=\"keyword\">implements</span> <span class=\"title\">HandlerExceptionResolver</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">resolveException</span><span class=\"params\">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object handler, Exception e)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(e <span class=\"keyword\">instanceof</span> ArithmeticException)&#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"处理了算术异常\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        ModelAndView mv = <span class=\"keyword\">new</span> ModelAndView();</span><br><span class=\"line\">        <span class=\"comment\">// 转向错误页面</span></span><br><span class=\"line\">        mv.setViewName(<span class=\"string\">\"error\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> mv;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"注册异常处理器\">注册异常处理器<a href=\"#注册异常处理器\" title=\"注册异常处理器\"></a></h2><p>直接实例化即可。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xmlns:mvc</span>=<span class=\"string\">\"http://www.springframework.org/schema/mvc\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">                           http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">                           http://www.springframework.org/schema/mvc</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">                           http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">                           http://www.springframework.org/schema/context</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">                           http://www.springframework.org/schema/context/spring-context.xsd \"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"controller\"</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--注册类型转换器--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mvc:annotation-driven</span> <span class=\"attr\">conversion-service</span>=<span class=\"string\">\"conversionService\"</span>/&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.web.servlet.view.InternalResourceViewResolver\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"prefix\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"/\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"suffix\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\".jsp\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--注册类型转换器--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"conversionService\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.context.support.ConversionServiceFactoryBean\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"converters\"</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">array</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">\"converter.StringToDateConverter\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">array</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--注册异常处理器--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">\"resolver.ExceptionResolver\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"controller\">Controller<a href=\"#controller\" title=\"Controller\"></a></h2><p><code>Controller</code>发生异常后，会交由我们自定义的异常处理器进行处理。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Controller</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/exception\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExceptionController</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">exceptionView</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> i = <span class=\"number\">1</span> / <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"success\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"方式二：controlleradvice--exceptionhandler\">方式二：@ControllerAdvice + @ExceptionHandler<a href=\"#方式二：controlleradvice--exceptionhandler\" title=\"方式二：@ControllerAdvice + @ExceptionHandler\"></a></h1><p>被<code>@ControllerAdvice</code>注解的类可以理解为增强的<code>Controller</code>。</p>\n<ul><li>参数<ul><li><code>basePackages</code>指定要通知的包</li>\n<li><code>basePackageClasses</code>用包中的一个类来指定要通知的包</li>\n<li><code>assignableTypes</code>指定要通知的类</li>\n</ul></li>\n<li>可实现功能<ul><li>全局异常处理</li>\n<li>全局数据绑定</li>\n<li>全局数据预处理</li>\n</ul></li>\n</ul><h2 id=\"全局异常处理\">全局异常处理<a href=\"#全局异常处理\" title=\"全局异常处理\"></a></h2><p>使用<code>@ExceptionHandler</code>注解在方法上，指定要处理的异常。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ControllerAdvice</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyControllerAdvice</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@ExceptionHandler</span>(ArithmeticException<span class=\"class\">.<span class=\"keyword\">class</span>)</span></span><br><span class=\"line\"><span class=\"class\">    <span class=\"title\">public</span> <span class=\"title\">String</span> <span class=\"title\">handleArithmeticException</span>(<span class=\"title\">Exception</span> <span class=\"title\">e</span>)</span>&#123;</span><br><span class=\"line\">        e.printStackTrace();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"算术异常\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"error\"</span>;</span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"全局数据绑定\">全局数据绑定<a href=\"#全局数据绑定\" title=\"全局数据绑定\"></a></h2><p>使用<code>@ModelAttribute</code>注解在方法上，可为所有的<code>Controller</code>预先绑定参数到<code>ModelMap</code>中（<strong>不限于在@ControllerAdvice中指定的类中的<code>Controller</code></strong>）。</p>\n<ul><li><code>ControllerAdvice</code>中的<code>@ModelAttribute</code>注解的方法要先于<code>Controller</code>的<code>@ModelAttribute</code>注解的方法执行(即MyControllerAdvice.bindModelMap要先于ExceptionController.bindModelMap执行)</li>\n</ul><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ControllerAdvice</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyControllerAdvice</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@ModelAttribute</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">bindModelMap</span><span class=\"params\">(ModelMap map)</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"bind global\"</span>);</span><br><span class=\"line\">        map.addAttribute(<span class=\"string\">\"global\"</span>, <span class=\"keyword\">new</span> Date());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Controller</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/exception\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ExceptionController</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">exceptionView</span><span class=\"params\">(@ModelAttribute(<span class=\"string\">\"date\"</span>)</span>Date global, @<span class=\"title\">ModelAttribute</span><span class=\"params\">(<span class=\"string\">\"local\"</span>)</span> Date local)</span>&#123;</span><br><span class=\"line\">        System.out.println(global);</span><br><span class=\"line\">        System.out.println(local);</span><br><span class=\"line\">        <span class=\"keyword\">int</span> i = <span class=\"number\">1</span> / <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"success\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@ModelAttribute</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">bindModelMap</span><span class=\"params\">(ModelMap map)</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"bind local\"</span>);</span><br><span class=\"line\">        map.addAttribute(<span class=\"string\">\"local\"</span>, <span class=\"keyword\">new</span> Date());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"全局数据预处理\">全局数据预处理<a href=\"#全局数据预处理\" title=\"全局数据预处理\"></a></h2><p>使用<code>@InitBinder</code>。</p>\n","prev":{"title":"5-SpringMVC拦截器","link":"post/Java/SpringMVC/5-SpringMVC拦截器"},"next":{"title":"3-SpringMVC请求响应","link":"post/Java/SpringMVC/3-SpringMVC请求响应"},"plink":"https://beginc.github.io/post/Java/SpringMVC/4-SpringMVC异常处理/","toc":[{"id":"异常处理概述","title":"异常处理概述","index":"1"},{"id":"方式一：handlerexceptionresolver","title":"方式一：HandlerExceptionResolver","index":"2","children":[{"id":"自定义异常处理器","title":"自定义异常处理器","index":"2.1"},{"id":"注册异常处理器","title":"注册异常处理器","index":"2.2"},{"id":"controller","title":"Controller","index":"2.3"}]},{"id":"方式二：controlleradvice--exceptionhandler","title":"方式二：@ControllerAdvice + @ExceptionHandler","index":"3","children":[{"id":"全局异常处理","title":"全局异常处理","index":"3.1"},{"id":"全局数据绑定","title":"全局数据绑定","index":"3.2"},{"id":"全局数据预处理","title":"全局数据预处理","index":"3.3"}]}]}