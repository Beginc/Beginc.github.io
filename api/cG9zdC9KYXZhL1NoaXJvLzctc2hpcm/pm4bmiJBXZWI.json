{"title":"7-shiro集成Web","date":"2020-02-06T07:29:51.000Z","date_formatted":{"ll":"Feb 6, 2020","L":"02/06/2020","MM-DD":"02-06"},"thumbnail":"post/Java/Shiro/7-shiro集成Web/cover.jpg","link":"post/Java/Shiro/7-shiro集成Web","categories":["Java","Shiro"],"updated":"2020-03-06T13:45:01.690Z","content":"<h1 id=\"环境准备\">环境准备<a href=\"#环境准备\" title=\"环境准备\"></a></h1><h2 id=\"maven配置\">Maven配置<a href=\"#maven配置\" title=\"Maven配置\"></a></h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>war<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.example<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>Test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.8.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">source</span>&gt;</span>11<span class=\"tag\">&lt;/<span class=\"name\">source</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">target</span>&gt;</span>11<span class=\"tag\">&lt;/<span class=\"name\">target</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.tomcat.maven<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">port</span>&gt;</span>8080<span class=\"tag\">&lt;/<span class=\"name\">port</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">uriEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">uriEncoding</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"导入依赖\">导入依赖<a href=\"#导入依赖\" title=\"导入依赖\"></a></h2><ul><li><strong>shiro-web</strong><ul><li>包含shiro-core</li>\n</ul></li>\n<li>Servlet + JSP API</li>\n</ul><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.shiro<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>shiro-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.4.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>commons-logging<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-logging<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet.jsp<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>javax.servlet.jsp-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.2.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>javax.servlet-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.1.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"shiro配置\">Shiro配置<a href=\"#shiro配置\" title=\"Shiro配置\"></a></h1><h2 id=\"配置environmentloaderlistener\">配置EnvironmentLoaderListener<a href=\"#配置environmentloaderlistener\" title=\"配置EnvironmentLoaderListener\"></a></h2><ul><li>shiroConfigLocations指定配置文件路径</li>\n</ul><p><strong>功能</strong></p>\n<ul><li>创建唯一的Environment</li>\n<li>加载配置文件</li>\n<li>创建，配置，绑定WebSecurityManager</li>\n</ul><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">web-app</span> <span class=\"meta-keyword\">PUBLIC</span></span></span><br><span class=\"line\"><span class=\"meta\">        <span class=\"meta-string\">\"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"</span></span></span><br><span class=\"line\"><span class=\"meta\">        <span class=\"meta-string\">\"http://java.sun.com/dtd/web-app_2_3.dtd\"</span> &gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">web-app</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">context-param</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>shiroConfigLocations<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>classpath:shiro.ini<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">context-param</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">listener</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">listener-class</span>&gt;</span>org.apache.shiro.web.env.EnvironmentLoaderListener<span class=\"tag\">&lt;/<span class=\"name\">listener-class</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">listener</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置核心shirofilter\">配置核心ShiroFilter<a href=\"#配置核心shirofilter\" title=\"配置核心ShiroFilter\"></a></h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE web-app PUBLIC</span><br><span class=\"line\">        <span class=\"string\">\"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"</span></span><br><span class=\"line\">        <span class=\"string\">\"http://java.sun.com/dtd/web-app_2_3.dtd\"</span> &gt;</span><br><span class=\"line\">&lt;web-app&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;context-param&gt;</span><br><span class=\"line\">        &lt;param-name&gt;shiroConfigLocations&lt;/param-name&gt;</span><br><span class=\"line\">        &lt;param-value&gt;classpath:shiro.ini&lt;/param-value&gt;</span><br><span class=\"line\">    &lt;/context-param&gt;</span><br><span class=\"line\">    </span><br><span class=\"line\">    &lt;listener&gt;</span><br><span class=\"line\">        &lt;listener-<span class=\"class\"><span class=\"keyword\">class</span>&gt;<span class=\"title\">org</span>.<span class=\"title\">apache</span>.<span class=\"title\">shiro</span>.<span class=\"title\">web</span>.<span class=\"title\">env</span>.<span class=\"title\">EnvironmentLoaderListener</span>&lt;/<span class=\"title\">listener</span>-<span class=\"title\">class</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">    &lt;/<span class=\"title\">listener</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\">    &lt;<span class=\"title\">filter</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">filter</span>-<span class=\"title\">name</span>&gt;<span class=\"title\">shiroFilter</span>&lt;/<span class=\"title\">filter</span>-<span class=\"title\">name</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">filter</span>-<span class=\"title\">class</span>&gt;<span class=\"title\">org</span>.<span class=\"title\">apache</span>.<span class=\"title\">shiro</span>.<span class=\"title\">web</span>.<span class=\"title\">servlet</span>.<span class=\"title\">ShiroFilter</span>&lt;/<span class=\"title\">filter</span>-<span class=\"title\">class</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">    &lt;/<span class=\"title\">filter</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">    &lt;<span class=\"title\">filter</span>-<span class=\"title\">mapping</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">filter</span>-<span class=\"title\">name</span>&gt;<span class=\"title\">shiroFilter</span>&lt;/<span class=\"title\">filter</span>-<span class=\"title\">name</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">        &lt;<span class=\"title\">url</span>-<span class=\"title\">pattern</span>&gt;/*&lt;/<span class=\"title\">url</span>-<span class=\"title\">pattern</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">    &lt;/<span class=\"title\">filter</span>-<span class=\"title\">mapping</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">&lt;/<span class=\"title\">web</span>-<span class=\"title\">app</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置拦截规则\">配置拦截规则<a href=\"#配置拦截规则\" title=\"配置拦截规则\"></a></h2><ul><li>URL拦截规则</li>\n<li>跳转路径<ul><li>authc.loginUrl登录的路径</li>\n<li>authc.successUrl登录成功后他的路径</li>\n<li>perms.unauthorizedUrl未授权时的路径</li>\n</ul></li>\n</ul><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[users]</span></span><br><span class=\"line\"><span class=\"attr\">user</span>=<span class=\"number\">123</span>,user</span><br><span class=\"line\"><span class=\"attr\">admin</span>=<span class=\"number\">123</span>,admin</span><br><span class=\"line\"><span class=\"section\">[roles]</span></span><br><span class=\"line\"><span class=\"attr\">user</span>=user:query</span><br><span class=\"line\"><span class=\"attr\">admin</span>=*</span><br><span class=\"line\"><span class=\"section\">[urls]</span></span><br><span class=\"line\">/index.jsp=anon</span><br><span class=\"line\">/user.jsp=authc, roles[user]</span><br><span class=\"line\">/admin.jsp=authc, perms[\"user:delete\"]</span><br><span class=\"line\"><span class=\"section\">[main]</span></span><br><span class=\"line\"><span class=\"attr\">authc.loginUrl</span>=/login.jsp</span><br><span class=\"line\"><span class=\"attr\">authc.successUrl</span>=/success.jsp</span><br><span class=\"line\"><span class=\"attr\">perms.unauthorizedUrl</span>=/unauthorized.jsp</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"url拦截\">URL拦截<a href=\"#url拦截\" title=\"URL拦截\"></a></h2><h3 id=\"url规则\">URL规则<a href=\"#url规则\" title=\"URL规则\"></a></h3><ul><li>明确路径</li>\n<li>?匹配一个字符</li>\n<li>*匹配一级</li>\n<li>**匹配多级</li>\n</ul><h3 id=\"filter\">Filter<a href=\"#filter\" title=\"Filter\"></a></h3><h4 id=\"authc\">authc<a href=\"#authc\" title=\"authc\"></a></h4><p><strong>类</strong></p>\n<p> org.apache.shiro.web.filter.authc.FormAuthenticationFilter</p>\n<p><strong>功能</strong></p>\n<ul><li>未登陆则跳转到loginUrl</li>\n<li>登陆成功跳转到successUrl</li>\n<li>若当前未登陆且当前请求为loginUrl发来的POST请求，则尝试从request中取出如下参数尝试进行登录<ul><li>usernameParam：默认为username</li>\n<li>passwordParam：默认为password</li>\n<li>rememberMeParam：默认为rememberMe</li>\n</ul></li>\n<li>尝试登录成功则跳转到successUrl</li>\n<li>尝试登录失败则抛出异常</li>\n</ul><h4 id=\"user\">user<a href=\"#user\" title=\"user\"></a></h4><ul><li>有rememberMe的请求可通过</li>\n<li>否则跳转到loginUrl</li>\n</ul><h4 id=\"anon\">anon<a href=\"#anon\" title=\"anon\"></a></h4><ul><li>无需登录即可访问</li>\n</ul><h4 id=\"roles\">roles<a href=\"#roles\" title=\"roles\"></a></h4><ul><li>验证用户是否有对应角色<ul><li>若已经登录但无角色，则跳转到unauthorizedUrl</li>\n<li>若未登陆，则跳转到loginUrl</li>\n</ul></li>\n</ul><h4 id=\"perms\">perms<a href=\"#perms\" title=\"perms\"></a></h4><ul><li>验证用户是否有对应权限<ul><li>若已经登录但无角色，则跳转到unauthorizedUrl</li>\n<li>若未登陆，则跳转到loginUrl</li>\n</ul></li>\n</ul><h4 id=\"nosessioncreation\">noSessionCreation<a href=\"#nosessioncreation\" title=\"noSessionCreation\"></a></h4><ul><li>不创建Session</li>\n</ul><h1 id=\"filter原理\">Filter原理<a href=\"#filter原理\" title=\"Filter原理\"></a></h1><h2 id=\"继承体系\">继承体系<a href=\"#继承体系\" title=\"继承体系\"></a></h2><ul><li>NamebleFilter拥有名字的过滤器</li>\n<li>OncePerRequestFilter<ul><li><code>public void setEnabled(boolean enabled)</code>可设置是否启用该过滤器</li>\n<li>保证过滤器只被执行一次（执行后再request域中设置一个标记）</li>\n</ul></li>\n<li>AdviceFilter实现了AOP风格的过滤器<ol><li>preHandle</li>\n<li>executeChain</li>\n<li>postHandle</li>\n<li>afterCompletion</li>\n</ol></li>\n<li>PathMatchingFilter当路径匹配时才执行的过滤器</li>\n<li>AccessControlFilter带访问控制的过滤器</li>\n</ul><h4 id=\"认证过滤器\">认证过滤器<a href=\"#认证过滤器\" title=\"认证过滤器\"></a></h4><img src=\"/post/Java/Shiro/7-shiro%E9%9B%86%E6%88%90Web/image-20200306201601318.png\" class=\"\">\n\n<h3 id=\"授权过滤器\">授权过滤器<a href=\"#授权过滤器\" title=\"授权过滤器\"></a></h3><img src=\"/post/Java/Shiro/7-shiro%E9%9B%86%E6%88%90Web/image-20200306201716438.png\" class=\"\">\n\n\n\n<h2 id=\"认证过滤器原理\">认证过滤器原理<a href=\"#认证过滤器原理\" title=\"认证过滤器原理\"></a></h2><h3 id=\"accesscontrolfilter\">AccessControlFilter<a href=\"#accesscontrolfilter\" title=\"AccessControlFilter\"></a></h3><ul><li><p>isAccessAllowed控制是否有权限放行</p>\n</li>\n<li><p>无权限访问则执行onAccessDenied方法</p>\n</li>\n<li><p>都为抽象方法，这里为<strong>重要扩展点</strong></p>\n</li>\n</ul><img src=\"/post/Java/Shiro/7-shiro%E9%9B%86%E6%88%90Web/image-20200306202556571.png\" class=\"\">\n\n<img src=\"/post/Java/Shiro/7-shiro%E9%9B%86%E6%88%90Web/image-20200306202653558.png\" class=\"\">\n\n<img src=\"/post/Java/Shiro/7-shiro%E9%9B%86%E6%88%90Web/image-20200306202710147.png\" class=\"\">\n\n<img src=\"/post/Java/Shiro/7-shiro%E9%9B%86%E6%88%90Web/image-20200306202721922.png\" class=\"\">\n\n<h3 id=\"authenticationfilter\">AuthenticationFilter<a href=\"#authenticationfilter\" title=\"AuthenticationFilter\"></a></h3><p>扩展isAccessAllowed方法，只有当登陆了才有权限访问</p>\n<img src=\"/post/Java/Shiro/7-shiro%E9%9B%86%E6%88%90Web/image-20200306203034503.png\" class=\"\">\n\n<h3 id=\"authenticatingfilter\">AuthenticatingFilter<a href=\"#authenticatingfilter\" title=\"AuthenticatingFilter\"></a></h3><ul><li>扩展了isAccessAllowed方法</li>\n</ul><img src=\"/post/Java/Shiro/7-shiro%E9%9B%86%E6%88%90Web/image-20200306203336316.png\" class=\"\">\n\n<ul><li>定义了executeLogin方法<ul><li>onLoginSuccess为扩展点</li>\n<li>onLoginFailure为扩展点</li>\n<li>createToken为扩展点</li>\n</ul></li>\n</ul><img src=\"/post/Java/Shiro/7-shiro%E9%9B%86%E6%88%90Web/image-20200306203456970.png\" class=\"\">\n\n<h3 id=\"formauthenticationfilter\">FormAuthenticationFilter<a href=\"#formauthenticationfilter\" title=\"FormAuthenticationFilter\"></a></h3><ol><li>扩展了onAccessDenied，提供了登陆能力</li>\n</ol><img src=\"/post/Java/Shiro/7-shiro%E9%9B%86%E6%88%90Web/image-20200306203638000.png\" class=\"\">\n\n<ol><li>扩展了onLoginSuccess，登陆成功进行跳转successUrl</li>\n</ol><img src=\"/post/Java/Shiro/7-shiro%E9%9B%86%E6%88%90Web/image-20200306203729529.png\" class=\"\">\n\n<ol><li>扩展了onLoginFailure，登陆失败设置异常信息到request中</li>\n</ol><img src=\"/post/Java/Shiro/7-shiro%E9%9B%86%E6%88%90Web/image-20200306204210340.png\" class=\"\">\n\n<ol><li>扩展了createToken，从request中获取创建Token的信息</li>\n</ol><img src=\"/post/Java/Shiro/7-shiro%E9%9B%86%E6%88%90Web/image-20200306203901587.png\" class=\"\">\n\n<h2 id=\"授权过滤器原理\">授权过滤器原理<a href=\"#授权过滤器原理\" title=\"授权过滤器原理\"></a></h2><h3 id=\"authorizationfilter\">AuthorizationFilter<a href=\"#authorizationfilter\" title=\"AuthorizationFilter\"></a></h3><img src=\"/post/Java/Shiro/7-shiro%E9%9B%86%E6%88%90Web/image-20200306204059281.png\" class=\"\">\n\n<h3 id=\"rolesauthorizationfilter\">RolesAuthorizationFilter<a href=\"#rolesauthorizationfilter\" title=\"RolesAuthorizationFilter\"></a></h3><img src=\"/post/Java/Shiro/7-shiro%E9%9B%86%E6%88%90Web/image-20200306204317910.png\" class=\"\">","prev":{"title":"8-shiro集成Spring","link":"post/Java/Shiro/8-shiro集成Spring"},"next":{"title":"6-shiro之Session","link":"post/Java/Shiro/6-shiro之Session"},"plink":"https://beginc.github.io/post/Java/Shiro/7-shiro集成Web/","toc":[{"id":"环境准备","title":"环境准备","index":"1","children":[{"id":"maven配置","title":"Maven配置","index":"1.1"},{"id":"导入依赖","title":"导入依赖","index":"1.2"}]},{"id":"shiro配置","title":"Shiro配置","index":"2","children":[{"id":"配置environmentloaderlistener","title":"配置EnvironmentLoaderListener","index":"2.1"},{"id":"配置核心shirofilter","title":"配置核心ShiroFilter","index":"2.2"},{"id":"配置拦截规则","title":"配置拦截规则","index":"2.3"},{"id":"url拦截","title":"URL拦截","index":"2.4","children":[{"id":"url规则","title":"URL规则","index":"2.4.1"},{"id":"filter","title":"Filter","index":"2.4.2"}]}]},{"id":"filter原理","title":"Filter原理","index":"3","children":[{"id":"继承体系","title":"继承体系","index":"3.1","children":[{"id":"授权过滤器","title":"授权过滤器","index":"3.1.1"}]},{"id":"认证过滤器原理","title":"认证过滤器原理","index":"3.2","children":[{"id":"accesscontrolfilter","title":"AccessControlFilter","index":"3.2.1"},{"id":"authenticationfilter","title":"AuthenticationFilter","index":"3.2.2"},{"id":"authenticatingfilter","title":"AuthenticatingFilter","index":"3.2.3"},{"id":"formauthenticationfilter","title":"FormAuthenticationFilter","index":"3.2.4"}]},{"id":"授权过滤器原理","title":"授权过滤器原理","index":"3.3","children":[{"id":"authorizationfilter","title":"AuthorizationFilter","index":"3.3.1"},{"id":"rolesauthorizationfilter","title":"RolesAuthorizationFilter","index":"3.3.2"}]}]}]}