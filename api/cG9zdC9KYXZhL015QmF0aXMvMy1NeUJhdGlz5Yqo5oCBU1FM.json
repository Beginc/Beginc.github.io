{"title":"3-MyBatis动态SQL","date":"2019-08-24T01:12:43.000Z","date_formatted":{"ll":"Aug 24, 2019","L":"08/24/2019","MM-DD":"08-24"},"thumbnail":"post/Java/MyBatis/3-MyBatis动态SQL/cover.jpg","link":"post/Java/MyBatis/3-MyBatis动态SQL","categories":["Java","MyBatis"],"updated":"2020-01-23T13:37:22.700Z","content":"<h1 id=\"if-where标签\">If-Where标签<a href=\"#if-where标签\" title=\"If-Where标签\"></a></h1><h2 id=\"需求\">需求<a href=\"#需求\" title=\"需求\"></a></h2><ul><li>根据名字或性别查询用户(有名字就用名字，有性别就用性别，两者都有就都用)</li>\n</ul><h2 id=\"编写sqlmap文件\">编写SqlMap文件<a href=\"#编写sqlmap文件\" title=\"编写SqlMap文件\"></a></h2><ul><li>用If来判断name和age是否存在, 仅当存在时才作为查询条件</li>\n<li>Where可用于处理条件语句, 还可以去掉<strong>前导and</strong>(当只有sex做条件时, 需要去掉前面的and)</li>\n</ul><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findByUsernameOrSex\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"pojo.User\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"pojo.User\"</span>&gt;</span></span><br><span class=\"line\">    select * from user</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">where</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"username != null\"</span>&gt;</span></span><br><span class=\"line\">            username = #&#123;username&#125;</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"sex != null\"</span>&gt;</span></span><br><span class=\"line\">            and sex = #&#123;sex&#125;</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">where</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"编写测试\">编写测试<a href=\"#编写测试\" title=\"编写测试\"></a></h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testUserFindByUsernameOrSex</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    User user = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">    List&lt;User&gt; users;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 根据username查询</span></span><br><span class=\"line\">    user.setUsername(<span class=\"string\">\"罗浩文\"</span>);</span><br><span class=\"line\">    users = userMapper.findByUsernameOrSex(user);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (User user1 : users) &#123;</span><br><span class=\"line\">        System.out.println(user1);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">\"-------------------------------------------------------------\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 根据sex查询</span></span><br><span class=\"line\">    user.setUsername(<span class=\"keyword\">null</span>);</span><br><span class=\"line\">    user.setSex(<span class=\"string\">\"男\"</span>);</span><br><span class=\"line\">    users = userMapper.findByUsernameOrSex(user);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (User user1 : users) &#123;</span><br><span class=\"line\">        System.out.println(user1);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">\"-------------------------------------------------------------\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 根据username和sex查询</span></span><br><span class=\"line\">    user.setUsername(<span class=\"string\">\"罗浩文\"</span>);</span><br><span class=\"line\">    user.setSex(<span class=\"string\">\"男\"</span>);</span><br><span class=\"line\">    users = userMapper.findByUsernameOrSex(user);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (User user1 : users) &#123;</span><br><span class=\"line\">        System.out.println(user1);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"foreach标签\">ForEach标签<a href=\"#foreach标签\" title=\"ForEach标签\"></a></h1><h2 id=\"需求-1\">需求<a href=\"#需求-1\" title=\"需求\"></a></h2><ul><li>给定一串id, 查找id在其中的用户(不定数量的id)</li>\n</ul><h2 id=\"编写sqlmap文件-1\">编写SqlMap文件<a href=\"#编写sqlmap文件-1\" title=\"编写SqlMap文件\"></a></h2><ul><li><code>collection</code>指定要遍历的数组或集合</li>\n<li><code>item</code>指定取出的元素名</li>\n<li><code>open</code>指定前缀</li>\n<li><code>close</code>指定后缀</li>\n<li><code>seperator</code>指定分隔符</li>\n</ul><h3 id=\"数组\">数组<a href=\"#数组\" title=\"数组\"></a></h3><ul><li>数组类型可写为<code>iterator</code>或<code>list</code></li>\n<li><strong>传数组时, collection名字必须为array</strong></li>\n</ul><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findInIDs\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"list\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"pojo.User\"</span>&gt;</span></span><br><span class=\"line\">    select * from user</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">where</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">foreach</span> <span class=\"attr\">collection</span>=<span class=\"string\">\"array\"</span> <span class=\"attr\">open</span>=<span class=\"string\">\"id in (\"</span> <span class=\"attr\">close</span>=<span class=\"string\">\")\"</span> <span class=\"attr\">separator</span>=<span class=\"string\">\",\"</span> <span class=\"attr\">item</span>=<span class=\"string\">\"id\"</span>&gt;</span></span><br><span class=\"line\">            #&#123;id&#125;</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">foreach</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">where</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"list\">List<a href=\"#list\" title=\"List\"></a></h3><ul><li>List类型可写成<code>list</code></li>\n<li><strong>传List时, collection名字必须为list</strong></li>\n</ul><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findInIDs\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"list\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"pojo.User\"</span>&gt;</span></span><br><span class=\"line\">    select * from user</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">where</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">foreach</span> <span class=\"attr\">collection</span>=<span class=\"string\">\"list\"</span> <span class=\"attr\">open</span>=<span class=\"string\">\"id in (\"</span> <span class=\"attr\">close</span>=<span class=\"string\">\")\"</span> <span class=\"attr\">separator</span>=<span class=\"string\">\",\"</span> <span class=\"attr\">item</span>=<span class=\"string\">\"id\"</span>&gt;</span></span><br><span class=\"line\">            #&#123;id&#125;</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">foreach</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">where</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"编写测试-1\">编写测试<a href=\"#编写测试-1\" title=\"编写测试\"></a></h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testUserFindInIDs</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    List&lt;Integer&gt; ids = List.of(<span class=\"number\">41</span>, <span class=\"number\">42</span>, <span class=\"number\">43</span>);</span><br><span class=\"line\">    List&lt;User&gt; users = userMapper.findInIDs(ids);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (User user : users) &#123;</span><br><span class=\"line\">        System.out.println(user);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"sql片段\">SQL片段<a href=\"#sql片段\" title=\"SQL片段\"></a></h1><p>可用于提取常用的一些SQL片段</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sql</span> <span class=\"attr\">id</span>=<span class=\"string\">\"selectAllAttr\"</span>&gt;</span></span><br><span class=\"line\">    select * from user</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">sql</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findAll\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"pojo.User\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">include</span> <span class=\"attr\">refid</span>=<span class=\"string\">\"selectAllAttr\"</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br></pre></td></tr></table></figure>","prev":{"title":"4-MyBatis关联查询","link":"post/Java/MyBatis/4-MyBatis关联查询"},"next":{"title":"2-MyBatis动态代理开发","link":"post/Java/MyBatis/2-MyBatis动态代理开发"},"plink":"https://beginc.github.io/post/Java/MyBatis/3-MyBatis动态SQL/","toc":[{"id":"if-where标签","title":"If-Where标签","index":"1","children":[{"id":"需求","title":"需求","index":"1.1"},{"id":"编写sqlmap文件","title":"编写SqlMap文件","index":"1.2"},{"id":"编写测试","title":"编写测试","index":"1.3"}]},{"id":"foreach标签","title":"ForEach标签","index":"2","children":[{"id":"需求-1","title":"需求","index":"2.1"},{"id":"编写sqlmap文件-1","title":"编写SqlMap文件","index":"2.2","children":[{"id":"数组","title":"数组","index":"2.2.1"},{"id":"list","title":"List","index":"2.2.2"}]},{"id":"编写测试-1","title":"编写测试","index":"2.3"}]},{"id":"sql片段","title":"SQL片段","index":"3"}]}