{"title":"2-MyBatis动态代理开发","date":"2019-08-23T15:52:46.000Z","date_formatted":{"ll":"Aug 23, 2019","L":"08/23/2019","MM-DD":"08-23"},"thumbnail":"post/Java/MyBatis/2-MyBatis动态代理开发/cover.jpg","link":"post/Java/MyBatis/2-MyBatis动态代理开发","categories":["Java","MyBatis"],"updated":"2020-01-23T12:43:13.219Z","content":"<h1 id=\"动态代理开发简介\">动态代理开发简介<a href=\"#动态代理开发简介\" title=\"动态代理开发简介\"></a></h1><p>使用动态代理开发，我们只需要负责定义查询相关的接口规范(Mapper)以及编写相应SQL语句，无需对接口进行实现，MyBatis借助动态代理技术为我们生成增强对象，实现相应的查询方法。</p>\n<h1 id=\"mybatis动态代理开发规范\">MyBatis动态代理开发规范<a href=\"#mybatis动态代理开发规范\" title=\"MyBatis动态代理开发规范\"></a></h1><ul><li>mapper方法名与SqlMap文件中对应statement的id一致</li>\n<li>mapper返回值类型与SqlMap文件中对应statement的返回类型一致</li>\n<li>mapper参数类型与SqlMap文件中对应statement的参数类型一致</li>\n<li><strong>SqlMap中namespace必须为Mapper接口的全称</strong></li>\n</ul><h1 id=\"建立usermapper\">建立UserMapper<a href=\"#建立usermapper\" title=\"建立UserMapper\"></a></h1><p>新建包<code>mapper</code>, 建立<code>UserMapper</code>接口</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">UserMapper</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">List&lt;User&gt; <span class=\"title\">findAll</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">User <span class=\"title\">find</span><span class=\"params\">(Integer id)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">save</span><span class=\"params\">(User user)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">update</span><span class=\"params\">(User user)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">delete</span><span class=\"params\">(Integer id)</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"修改userxml中的namespace\">修改User.xml中的namespace<a href=\"#修改userxml中的namespace\" title=\"修改User.xml中的namespace\"></a></h1><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">mapper</span></span></span><br><span class=\"line\"><span class=\"meta\">PUBLIC <span class=\"meta-string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span></span></span><br><span class=\"line\"><span class=\"meta\"><span class=\"meta-string\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"mapper.UserMapper\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findAll\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"pojo.User\"</span>&gt;</span></span><br><span class=\"line\">        select * from user</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"find\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"pojo.User\"</span>&gt;</span></span><br><span class=\"line\">        select * from user where id = #&#123;id&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">delete</span> <span class=\"attr\">id</span>=<span class=\"string\">\"delete\"</span>&gt;</span></span><br><span class=\"line\">        delete from user where id = #&#123;id&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">delete</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">update</span> <span class=\"attr\">id</span>=<span class=\"string\">\"update\"</span>&gt;</span></span><br><span class=\"line\">        update user set</span><br><span class=\"line\">        username = #&#123;username&#125;, address = #&#123;address&#125;, sex = #&#123;sex&#125;, birthday = #&#123;birthday&#125;</span><br><span class=\"line\">        where id = #&#123;id&#125;</span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">update</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">insert</span> <span class=\"attr\">id</span>=<span class=\"string\">\"save\"</span>&gt;</span></span><br><span class=\"line\">        insert into user</span><br><span class=\"line\">        (username, address, sex, birthday) values</span><br><span class=\"line\">        (#&#123;username&#125;, #&#123;address&#125;, #&#123;sex&#125;, #&#123;birthday&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">selectKey</span> <span class=\"attr\">keyProperty</span>=<span class=\"string\">\"id\"</span> <span class=\"attr\">keyColumn</span>=<span class=\"string\">\"id\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"Integer\"</span>&gt;</span></span><br><span class=\"line\">            select LAST_INSERT_ID()</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">selectKey</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">insert</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"编写测试\">编写测试<a href=\"#编写测试\" title=\"编写测试\"></a></h1><ul><li>通过SqlSession获取Mapper</li>\n<li>调用Mapper的方法</li>\n</ul><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Test01</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Logger logger = LoggerFactory.getLogger(Test01<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> SqlSessionFactory factory;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> SqlSession session;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserMapper userMapper;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@BeforeClass</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">setUpClass</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">        factory = <span class=\"keyword\">new</span> SqlSessionFactoryBuilder().build(Resources.getResourceAsStream(<span class=\"string\">\"SqlMapConfig.xml\"</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Before</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUp</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">        session = factory.openSession();</span><br><span class=\"line\">        userMapper = session.getMapper(UserMapper<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@After</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">tearDown</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        session.commit();</span><br><span class=\"line\">        session.close();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testUserFindAll</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        List&lt;User&gt; users = userMapper.findAll();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (User user : users) &#123;</span><br><span class=\"line\">            System.out.println(user);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testUserSave</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        User user = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">        user.setAddress(<span class=\"string\">\"耒阳\"</span>);</span><br><span class=\"line\">        user.setUsername(<span class=\"string\">\"罗浩文\"</span>);</span><br><span class=\"line\">        user.setBirthday(<span class=\"keyword\">new</span> Date());</span><br><span class=\"line\">        user.setSex(<span class=\"string\">\"男\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        userMapper.save(user);</span><br><span class=\"line\">        System.out.println(user);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testUserDelete</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        userMapper.delete(<span class=\"number\">57</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testUserFind</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        User user = userMapper.find(<span class=\"number\">41</span>);</span><br><span class=\"line\">        System.out.println(user);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n","prev":{"title":"3-MyBatis动态SQL","link":"post/Java/MyBatis/3-MyBatis动态SQL"},"next":{"title":"1-MyBatis入门","link":"post/Java/MyBatis/1-MyBatis入门"},"plink":"https://beginc.github.io/post/Java/MyBatis/2-MyBatis动态代理开发/","toc":[{"id":"动态代理开发简介","title":"动态代理开发简介","index":"1"},{"id":"mybatis动态代理开发规范","title":"MyBatis动态代理开发规范","index":"2"},{"id":"建立usermapper","title":"建立UserMapper","index":"3"},{"id":"修改userxml中的namespace","title":"修改User.xml中的namespace","index":"4"},{"id":"编写测试","title":"编写测试","index":"5"}]}