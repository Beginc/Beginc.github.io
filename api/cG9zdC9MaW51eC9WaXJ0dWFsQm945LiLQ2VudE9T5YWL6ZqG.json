{"title":"VirtualBox下CentOS克隆","date":"2019-09-09T14:44:38.000Z","date_formatted":{"ll":"Sep 9, 2019","L":"09/09/2019","MM-DD":"09-09"},"thumbnail":"post/Linux/VirtualBox下CentOS克隆/cover.jpg","link":"post/Linux/VirtualBox下CentOS克隆","categories":["Linux"],"updated":"2020-01-08T08:31:06.569Z","content":"<h1 id=\"centos-minimal安装配置\">CentOS-Minimal安装配置<a href=\"#centos-minimal安装配置\" title=\"CentOS-Minimal安装配置\"></a></h1><p>先用<code>Minimal</code>镜像安装好一台虚拟机，进行配置。</p>\n<h2 id=\"安装wget\">安装wget<a href=\"#安装wget\" title=\"安装wget\"></a></h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum install wget</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"源配置\">源配置<a href=\"#源配置\" title=\"源配置\"></a></h2><p>详见</p>\n<h2 id=\"安装ifconfig\">安装ifconfig<a href=\"#安装ifconfig\" title=\"安装ifconfig\"></a></h2><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo yum install net-tools</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"桥接网络设置\">桥接网络设置<a href=\"#桥接网络设置\" title=\"桥接网络设置\"></a></h2><p>详见</p>\n<h2 id=\"设置开机菜单选择时间\">设置开机菜单选择时间<a href=\"#设置开机菜单选择时间\" title=\"设置开机菜单选择时间\"></a></h2><p>缩短选择时间，快速开机。</p>\n<p><strong>CentOS7</strong></p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vi /etc/grub2.cfg</span><br></pre></td></tr></table></figure>\n<img src=\"/post/Linux/VirtualBox%E4%B8%8BCentOS%E5%85%8B%E9%9A%86/5.png\" class=\"\">\n\n\n<h1 id=\"centos克隆准备\">CentOS克隆准备<a href=\"#centos克隆准备\" title=\"CentOS克隆准备\"></a></h1><p>由于克隆后两台虚拟机会有相同的MAC地址，发生冲突，需要提前先进行一些配置。</p>\n<ol><li>删除MAC和UUID</li>\n</ol><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vi /etc/sysconfig/network-scripts/ifcfg-enp0s3</span><br></pre></td></tr></table></figure>\n<p>将<code>HWADDR</code>和<code>UUID</code>注释掉，解除其与网卡名称的绑定。</p>\n<ol><li>删除文件\n该文件将网卡名和MAC地址进行了绑定，克隆后的虚拟机会使用新的MAC地址，将会出错。</li>\n</ol><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo rm /etc/udev/rules.d/70-persistent-ipoib.rules</span><br></pre></td></tr></table></figure>\n\n<ol><li>重启网络服务</li>\n</ol><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service network restart</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"生成快照\">生成快照<a href=\"#生成快照\" title=\"生成快照\"></a></h1><p>安装完后，在<code>VirtualBox</code>中生成快照，之后可用于克隆。</p>\n<img src=\"/post/Linux/VirtualBox%E4%B8%8BCentOS%E5%85%8B%E9%9A%86/1.png\" class=\"\">\n\n<img src=\"/post/Linux/VirtualBox%E4%B8%8BCentOS%E5%85%8B%E9%9A%86/2.png\" class=\"\">\n\n<h1 id=\"克隆虚拟机\">克隆虚拟机<a href=\"#克隆虚拟机\" title=\"克隆虚拟机\"></a></h1><img src=\"/post/Linux/VirtualBox%E4%B8%8BCentOS%E5%85%8B%E9%9A%86/3.png\" class=\"\">\n\n<h1 id=\"更新克隆机的mac地址\">更新克隆机的MAC地址<a href=\"#更新克隆机的mac地址\" title=\"更新克隆机的MAC地址\"></a></h1><img src=\"/post/Linux/VirtualBox%E4%B8%8BCentOS%E5%85%8B%E9%9A%86/4.png\" class=\"\">\n\n<h1 id=\"修改静态ip\">修改静态IP<a href=\"#修改静态ip\" title=\"修改静态IP\"></a></h1><p>克隆后的虚拟机和其父本有一样的IP，需要修改。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 打开后对IPADDR进行更改</span></span><br><span class=\"line\">sudo vi /etc/sysconfig/network-scripts/ifcfg-enp0s3</span><br></pre></td></tr></table></figure>\n<h1 id=\"主机名修改\">主机名修改<a href=\"#主机名修改\" title=\"主机名修改\"></a></h1><p>这一步不是必要的。</p>\n<p><strong>CentOS7</strong></p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vi /etc/hostname</span><br></pre></td></tr></table></figure>\n<p>设置<code>hostname</code>,重启生效。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">node01</span><br></pre></td></tr></table></figure>\n\n<p><strong>CentOS6</strong></p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vi /etc/sysconfig/network</span><br></pre></td></tr></table></figure>\n<p>设置<code>hostname</code>,重启生效。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HOSTNAME=node01</span><br></pre></td></tr></table></figure>\n\n<p><strong>设置hostname映射</strong>\n将<code>hostname</code>映射到<code>IP</code></p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vi /etc/hosts</span><br></pre></td></tr></table></figure>\n<p>设置映射</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 本机可以不设置</span></span><br><span class=\"line\">192.168.1.101 node01</span><br><span class=\"line\"><span class=\"comment\"># 设置别的机器的映射</span></span><br><span class=\"line\">192.168.1.102 node02</span><br></pre></td></tr></table></figure>","prev":{"title":"MIPS-Like单周期16位CPU设计","link":"post/Hardware/MIPS-Like单周期CPU设计"},"next":{"title":"各种源配置","link":"post/其他/各种源配置"},"plink":"https://beginc.github.io/post/Linux/VirtualBox下CentOS克隆/","toc":[{"id":"centos-minimal安装配置","title":"CentOS-Minimal安装配置","index":"1","children":[{"id":"安装wget","title":"安装wget","index":"1.1"},{"id":"源配置","title":"源配置","index":"1.2"},{"id":"安装ifconfig","title":"安装ifconfig","index":"1.3"},{"id":"桥接网络设置","title":"桥接网络设置","index":"1.4"},{"id":"设置开机菜单选择时间","title":"设置开机菜单选择时间","index":"1.5"}]},{"id":"centos克隆准备","title":"CentOS克隆准备","index":"2"},{"id":"生成快照","title":"生成快照","index":"3"},{"id":"克隆虚拟机","title":"克隆虚拟机","index":"4"},{"id":"更新克隆机的mac地址","title":"更新克隆机的MAC地址","index":"5"},{"id":"修改静态ip","title":"修改静态IP","index":"6"},{"id":"主机名修改","title":"主机名修改","index":"7"}]}